// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client"
  output   = "../lib/generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  user_id Int     @id @default(autoincrement()) @db.SmallInt
  name    String  @db.VarChar(50)
  role String? @db.VarChar(50)
  image String? 
  email   String  @unique @db.VarChar(65)
  password String? @db.VarChar(255)
  summary String? @db.VarChar(500)
  skills  Skill[]
  experiences Experience[]
  links Link[]
  educations  Education[]
  languages Language[]
  company_members  CompanyMember[]
  job_applicants JobApplicant[]
  notifications      Notification[] @relation("Receiver")
  sent_notifications Notification[] @relation("Sender")
  @@map("user")
}

model Skill {
  skill_id Int  @id @default(autoincrement()) @db.SmallInt
  user_id Int   @db.SmallInt
  skill String @db.VarChar(30)
  user User @relation(fields: [user_id], references: [user_id])
  @@index([user_id])
  @@map("skill")
}

model Language {
  language_id Int  @id @default(autoincrement()) @db.SmallInt
  user_id Int   @db.SmallInt
  language String @db.VarChar(20)
  proficiency String @db.VarChar(6)
  user User @relation(fields: [user_id], references: [user_id])
  @@index([user_id])
  @@map("language")
}

model Experience {
  experience_id Int  @id @default(autoincrement()) @db.SmallInt
  user_id Int   @db.SmallInt
  company String @db.VarChar(30)
  role String @db.VarChar(30)
  years String @db.VarChar(3)
  start_date DateTime @db.Date
  end_date String
  employment_type String @db.VarChar(9)
  description String @db.VarChar(500)
  user User @relation(fields: [user_id], references: [user_id])
  @@index([user_id])
  @@map("experience")
}


model Education {
  education_id Int  @id @default(autoincrement()) @db.SmallInt
  user_id Int   @db.SmallInt
  institution String @db.VarChar(50)
  field_of_study String @db.VarChar(30)
  qualification String @db.VarChar(16)
  start_date DateTime @db.Date
  end_date String
  description String @db.VarChar(500)
  study_type String @db.VarChar(9)
  user User @relation(fields: [user_id], references: [user_id])
  @@index([user_id])
  @@map("education")
}


model Link {
  link_id  Int     @id @default(autoincrement()) @db.SmallInt
  user_id  Int     @db.SmallInt
  type     String  @db.VarChar(20) // 'website', 'linkedin', 'github', 'twitter', 'portfolio', 'other'
  url      String  @db.VarChar(255)
  user     User    @relation(fields: [user_id], references: [user_id], onDelete: Cascade)
  @@index([user_id])
  @@map("link")
}


model Company {
  company_id Int     @id @default(autoincrement()) @db.SmallInt
  name    String  @db.VarChar(50)
  image String? 
  industry String  @db.VarChar(20)
  location String  @db.VarChar(50)
  description String? @db.VarChar(500)
  company_members  CompanyMember[]
  job_posts JobPost[]
  notification Notification[]
  @@map("company")
}


model CompanyMember {
  company_member_id Int     @id @default(autoincrement()) @db.SmallInt
  company_id Int   @db.SmallInt
  user_id Int   @db.SmallInt
  role String  @db.VarChar(6)
  removed Boolean @default(false)
  user User @relation(fields: [user_id], references: [user_id])
  company Company @relation(fields: [company_id], references: [company_id])
  @@map("company_member")
}

model JobPost {
  job_post_id Int     @id @default(autoincrement()) @db.SmallInt
  company_id Int   @db.SmallInt
  title String  @db.VarChar(50)
  industry String  @db.VarChar(20)
  requirements String[]
  responsibilities String[]
  employment_type String  @db.VarChar(9)
  experience String @db.VarChar(3)
  created_at DateTime @db.Date
  removed Boolean @default(false)
  salary_start Int   @db.SmallInt
  salary_end Int   @db.SmallInt
  location String @db.VarChar(6)
  benefit String[]
  contact_email String @db.VarChar(65)
  description String @db.VarChar(500)
  summary String @db.VarChar(100)
  job_applicants JobApplicant[]
  notification Notification[]
  company Company @relation(fields: [company_id], references: [company_id])
  @@index([company_id]) 
  @@index([created_at]) 
  @@map("job_post")
}


model JobApplicant {
  applicant_id Int  @id @default(autoincrement()) @db.SmallInt
  user_id Int   @db.SmallInt
  job_post_id Int   @db.SmallInt
  status String  @db.VarChar(10) @default("PENDING")
  expected_salary Int   @db.SmallInt
  applied_date DateTime @db.Date
  interview_date DateTime? @db.Date 
  interview_time String? @db.VarChar(7)
  user User @relation(fields: [user_id], references: [user_id])
  job_post JobPost @relation(fields: [job_post_id], references: [job_post_id])
  @@map("job_applicant")
}


// model Notification {
//   notification_id Int   @id @default(autoincrement()) @db.SmallInt
//   user_id Int   @db.SmallInt
//   type String  @db.VarChar(9)
//   message String  @db.VarChar(300)
//   is_read Boolean @default(false)
//   created_at DateTime @db.Date
//   user User @relation(fields: [user_id], references: [user_id])
//   @@map("notification")
// }


model Notification {
  notification_id Int      @id @default(autoincrement())
  user_id         Int      // Receiver
  sender_id       Int?     // Triggering User (Colleague or Applicant) the sender's user_id
  company_id      Int?     // Triggering Company (Logo source)
  job_post_id     Int?     // Context for Job Title
  type            String
  message         String
  created_at      DateTime @default(now())
  is_read Boolean @default(false)
  user   User  @relation("Receiver", fields: [user_id], references: [user_id])
  sender User? @relation("Sender", fields: [sender_id], references: [user_id])
  company    Company? @relation(fields: [company_id], references: [company_id])
  job_post   JobPost? @relation(fields: [job_post_id], references: [job_post_id])
  @@index([user_id])
  @@map("notification")
}

/*
// type
COMPANY_MEMBER_ADD
COMPANY_MEMBER_REMOVE
COMPANY_MEMBER_UPDATE
COMPANY_PROFILE_UPDATE
JOB_POST_CREATED
JOB_POST_UPDATED
APPLICANT_NEW (For HR)
APPLICANT_STATUS_CHANGE (For the User)
*/